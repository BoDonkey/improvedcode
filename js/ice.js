tinyMCEPopup.requireLangPack();function ImprovedCodeEditor(){var e=null;this.init=function(){tinyMCEPopup.resizeToInnerSize();if(tinymce.isGecko)document.body.spellcheck=tinyMCEPopup.editor.getParam("gecko_spellcheck");document.getElementById('htmlSource').value=tinyMCEPopup.editor.getContent({source_view:true});_setWrap('soft');this.resizeInputs();e=tinyMCEPopup.getWindowArg("settings");if(e.optionsBar){document.getElementById('wraped').checked=e.lineWrapping;document.getElementById('highlighting').checked=true;document.getElementById('indented').checked=e.autoIndent;document.getElementById('linenumbers').checked=e.lineNumbers}else{var a=document.getElementById('optionsBar');a.parentNode.removeChild(a)}e.url=tinyMCEPopup.getWindowArg("plugin_url");e.themeUrl="js/codemirror/theme/";e.theme=_sanitizeTheme(e.theme,e.themeUrl);_loadCssTheme();e.cme=_initCodeMirror(e);_resizeCodeMirror();if(e.autoIndent){_indentCode(true)}};this.resizeInputs=function(){var a=tinyMCEPopup.dom.getViewPort(window),el;el=document.getElementById('htmlSource');if(el){el.style.width=(a.w-20)+'px';el.style.height=(a.h-65)+'px'}if(null!==e)_resizeCodeMirror()};this.saveContent=function(){var a=document.getElementById('htmlSource').value;if(null!==e){a=e.cme.getDoc().getValue()}tinyMCEPopup.editor.setContent(a,{source_view:true});tinyMCEPopup.close()};this.toggleHighlighting=function(a){if(a.checked){e.cme.setOption("theme",e.theme)}else{e.cme.setOption("theme","none")}};this.toggleIndent=function(a){_indentCode(a.checked)};this.toggleLineNumbers=function(a){e.cme.setOption("lineNumbers",a.checked)}this.toggleWordWrap=function(a){e.cme.setOption("lineWrapping",a.checked)};function _fileExists(a){var b=new XMLHttpRequest();b.open('HEAD',a,false);b.send();return b.status==200};function _indentCode(a){var b=e.cme.getDoc().lineCount();var c=a?"smart":"substract";for(var i=0;i<b;i++){e.cme.indentLine(i,c)}};function _initCodeMirror(a,b){var c=document.getElementById("htmlSource");var d=CodeMirror.fromTextArea(c,{indentUnit:a.indentUnit,tabSize:a.tabSize,lineNumbers:a.lineNumbers,theme:a.theme,lineWrapping:a.lineWrapping,mode:"application/xml"});return d};function _loadCssTheme(){if(''==e.theme||'default'==e.theme)return null;var a=document.createElement("link")a.setAttribute("rel","stylesheet")a.setAttribute("type","text/css")a.setAttribute("href",e.themeUrl+e.theme+".css");document.getElementsByTagName("head")[0].appendChild(a)};function _resizeCodeMirror(){var a=tinyMCEPopup.dom.getViewPort(window);e.cme.setSize("100%",a.h-60)};function _sanitizeTheme(a,b){if(''==a||'default'==a)return'default';if(_fileExists(b+a+".css")){return a}else{return''}};function _setWrap(a){var v,n,s=document.getElementById('htmlSource');s.wrap=a;if(!tinymce.isIE){v=s.value;n=s.cloneNode(false);n.setAttribute("wrap",a);s.parentNode.replaceChild(n,s);n.value=v}}}var ice=new ImprovedCodeEditor();tinyMCEPopup.onInit.add(ice.init,ice);
